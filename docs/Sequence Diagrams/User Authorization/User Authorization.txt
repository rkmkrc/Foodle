title Foodle User Authorization UML Sequence Diagram

participant User

participant UI

participant Server

participant Database Server

alt user register
User->UI: registerToApp() 
UI->Server: userRegisterRequest(userDetails)
Server->Server: sendVerificationCode()
UI->Server: postVerificationCode(verificationBody)
Server-->UI : verificationResult
alt verificationResult = true
Server->Database Server: createNewUser(userDetails)
Server->Server: generateAccessToken()
Server-->UI: verifiedAccessToken
else verificationResult = false
Server-->UI: verificationResultError
end

else user login
User->UI: userLogin() 
UI->Server: userLoginRequest(userCredentials)
Server->Database Server: verifyUserCredentials(userCredentials)
Database Server-->Server: verificationResult

alt verificationResult = true
Server->Server: send2FAVerificationCode()
UI->Server: post2FAVerificationCode(2FABody)
Server-->UI : 2FAVerificationResult
alt 2FAVerificationResult = true
Server->Server: generateAccessToken()
Server->Database Server: openNewUserSession()
Server-->UI: verifiedAccessToken
else 2FAVerificationResult = false
Server-->UI: 2FAVerificationError
end
else verificationResult = false
Server-->UI: credentialsError
end
end